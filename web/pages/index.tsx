import Head from 'next/head'
import Link from 'next/link'
import Footer from '../components/footer'
import Navbar from '../components/navbar'
import { NoteResume } from '../interfaces'
import useSwr from 'swr'
import styles from '../styles/Home.module.css'
import { useNote } from '../contexts/note'
import { useEffect } from 'react'
import CardsView from '../components/notesViews/cardsView'
import { useView } from '../contexts/view'

const fetcher = (url: string) => fetch(url).then((res) => res.json())

export default function Home() {
  const { data, error } = useSwr<NoteResume[]>('/api/notes', fetcher)
  const { setSummaryNotes } = useNote()
  const { view } = useView()

  useEffect(() => {
    if (data)
      setSummaryNotes(data)
  }, [data])

  if (error) return <div>Failed to load users</div>
  if (!data) return <div>Loading...</div>

  return (
    <div className={styles.container}>
      <Head>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Navbar />

      <main className={styles.main}>
        <h1 className={styles.title}>
          {data.length} vaults
        </h1>

        {/* Bot√£o de novo */}
        <Link href="/new" className="d-grid gap-2 col-2 mx-auto my-4">
          <button className="btn btn-outline-success btn-lg" type="button">Novo</button>
        </Link>

        { view === 'Card' ? <CardsView data={data} /> : null}

      </main>

      <Footer />
    </div>
  )
}
